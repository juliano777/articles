PostgreSQL: PL/Python - Writing Functions and Stored Procedures in Python 


About this article

	This is a alternative version of "On snakes and elephants Using Python inside PostgreSQL" by Jan UrbaÅ„ski.

	https://wulczer.org/pywaw-summit.pdf

About Python

- Very high level programming language;
- Fully object oriented;
- Easy to learn;
- Easy maintenance;
- Batteries included (Standard libraries / modules);
- Wide variety of third party libraries / modules;
- General purpose, e. g.; Script, Web, Desktop, Embbeded;
- Strong and dynamic typing;
- Strong and friendly community;
- Objective and very productive: do more writing less! :)

> import this [https://www.python.org/dev/peps/pep-0020/]


www.python.org


About PostgreSQL

	PostgreSQL is a Object Relational Database Management System, originally developed at the University of California, Department of Computer Science in Berkeley.
	It's currently developed and maintained by the PGDG (PostgreSQL Global Development Group).

- Open source;
- Rich in advanced features;
- Very friendly for developers;
- Extensible;
- Multi paradigm: relational and NoSQL features;

www.postgresql.org


Functions and Stored Procedures in PostgreSQL

- In PostgreSQL the default procedural language is PL/pgSQL, that is very similar to Oracle's PL/SQL;
- Implements operations that are not be easy or not possible with pure SQL;
- A function or a stored procedure is called inside SQL;
- It can encapsulate logic business;
- PL/Python, PL/Perl and PL/Tcl are nativelly supported, but is possible to use other procedural languages such as PL/Java, PL/PHP, PL/v8 (JavaScript), PL/R and etc;
- Support for function overload.


Functions vs Stored Procedures

Function

- Can RETURN a value;
- Executed by a simple SELECT statement;


Stored Procedure

- Can run Transactions (COMMIT / ROLLBACK);
- Executed by a CALL statement;



Examples... (PL/PgSQL)


Table for tests:

CREATE TABLE tb_foo (my_field int);



Function creation:

CREATE OR REPLACE FUNCTION fc_foo (my_value INT)
RETURNS INT AS $body$

BEGIN
    -- A simple calculation...
    RETURN my_value * 3;
END;

$body$ LANGUAGE PLPGSQL;



Stored procedure creation:

CREATE OR REPLACE PROCEDURE sp_foo (my_value INT) AS $body$

BEGIN
    INSERT INTO tb_foo (my_field) SELECT fc_foo(my_value);
END;

$body$ LANGUAGE PLPGSQL;



Call the procedure:

CALL sp_foo(7);



Check the result:

SELECT my_field FROM tb_foo;

+------------+
| my_field   |
|------------|
| 21         |
+------------+

	We can notice the result after combining a function and a stored procedure (just for example).


















